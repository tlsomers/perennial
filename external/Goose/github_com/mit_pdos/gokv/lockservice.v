(* autogenerated from github.com/mit-pdos/gokv/lockservice *)
From Perennial.goose_lang Require Import prelude.
From Perennial.goose_lang Require Import ffi.grove_prelude.

From Goose Require github_com.mit_pdos.gokv.memkv.

Definition LockClerk := struct.decl [
  "kv" :: struct.ptrT memkv.MemKVClerk
].

Definition LockClerk__Lock: val :=
  rec: "LockClerk__Lock" "ck" "key" :=
    Skip;;
    (for: (λ: <>, memkv.MemKVClerk__ConditionalPut (struct.loadF LockClerk "kv" "ck") "key" (NewSlice byteT #0) (NewSlice byteT #1)); (λ: <>, Skip) := λ: <>,
      Continue).

Definition LockClerk__Unlock: val :=
  rec: "LockClerk__Unlock" "ck" "key" :=
    memkv.MemKVClerk__Put (struct.loadF LockClerk "kv" "ck") "key" (NewSlice byteT #0).

Definition MakeLockClerk: val :=
  rec: "MakeLockClerk" "lockhost" :=
    struct.new LockClerk [
      "kv" ::= memkv.MakeMemKVClerk "lockhost"
    ].
