(* autogenerated from github.com/mit-pdos/go-mvcc/tid *)
From Perennial.goose_lang Require Import prelude.
From Goose Require github_com.mit_pdos.go_mvcc.config.

From Perennial.goose_lang Require Import ffi.grove_prelude.

Definition GenTID: val :=
  rec: "GenTID" "sid" :=
    let: "tid" := ref (zero_val uint64T) in
    "tid" <-[uint64T] grove_ffi.GetTSC #();;
    "tid" <-[uint64T] (![uint64T] "tid" + config.N_TXN_SITES) `and` (~ (config.N_TXN_SITES - #1)) + "sid";;
    Skip;;
    (for: (λ: <>, grove_ffi.GetTSC #() ≤ ![uint64T] "tid"); (λ: <>, Skip) := λ: <>,
      Continue);;
    ![uint64T] "tid".
